<?xml version="1.0"?>
<project name="MongoVision" default="build">

	<property file="component.properties" />
	
	<property name="reference" value="../components/reference" />
	<property name="mongovision" value="../components/mongovision" />
	
	<property name="distribution" value="./distribution" />
	<property name="distribution.content" value="${distribution}/content" />

	<target name="sincerity" description="Create Sincerity container">
		<copy todir="${distribution.content}/configuration/sincerity">
			<fileset dir="sincerity" />
		</copy>
		<exec executable="${sincerity.home}/sincerity">
			<arg value="container:create" />
			<arg value="--force" />
			<arg value="${distribution.content}" />
			<arg value="${sincerity.template}" />
			<arg value=":" />
			<arg value="repositories:attach" />
			<arg value="three-crickets" />
			<arg value=":" />
			<arg value="install" />
		</exec>
	</target>

	<target name="distribution" depends="sincerity" description="Assemble distribution">
		<copy todir="${distribution.content}">
			<fileset dir="${reference}" />
			<fileset dir="${mongovision}" />
		</copy>
	</target>

	<target name="package" depends="distribution" description="Create distribution package">
		<zip destfile="${distribution}/${component}-${version}.zip">
			<zipfileset dir="${distribution.content}" excludes="cache/, logs/, sincerity" />
			<zipfileset dir="${distribution.content}" includes="sincerity" filemode="755" />
		</zip>
	</target>
	
	<target name="build" depends="package" description="Build distribution" />
	
	<target name="clean" description="Clean">
		<delete dir="${distribution}" />
	</target>
	
	<target name="rebuild" depends="clean, build" description="First clean and then build distribution" />
	
</project>
