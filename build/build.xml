<?xml version="1.0"?>
<project name="MongoVision" default="build">
	
	<property name="src" value="../modules/mongovision/src" />
	<property name="lib" value="../libraries" />
	<property name="deploy" value="../modules/mongovision/deploy" />
	<property name="dist" value="./distribution" />
	<property name="tmp" value="./tmp" />
	<property name="content" value="${dist}/content" />

	<target name="licenses" description="Fetch licences">
		<copy todir="${content}/licenses/ext-js">
			<fileset dir="${lib}/ext-js/license" />
		</copy>
		<copy todir="${content}/licenses/gritter">
			<fileset dir="${lib}/gritter/license" />
		</copy>
		<copy todir="${content}/licenses/mongodb-java-driver">
			<fileset dir="${lib}/mongodb-java-driver/license" />
		</copy>
		<copy todir="${content}/licenses/mongodb-rhino-driver">
			<fileset dir="${lib}/mongodb-rhino-driver/license" />
		</copy>
	</target>

	<target name="libraries" description="Fetch libraries">
		<copy todir="${content}/licenses">
			<fileset dir="${lib}" includes="*.txt" />
		</copy>
		<copy todir="${tmp}/applications/mongovision/web/static/script/ext">
			<fileset dir="${lib}/ext-js/lib" includes="*.js" />
			<fileset dir="${lib}/ext-js/lib/adapter/ext" />
		</copy>
		<copy todir="${tmp}/applications/mongovision/web/static/style/ext">
			<fileset dir="${lib}/ext-js/lib/resources" />
		</copy>
		<copy todir="${tmp}/applications/mongovision/web/static/script/ux">
			<fileset dir="${lib}/gritter/lib" includes="*.js" />
		</copy>
		<copy todir="${tmp}/applications/mongovision/web/static/style/ux/gritter">
			<fileset dir="${lib}/gritter/lib/resources" />
		</copy>
		<copy todir="${content}/libraries/">
			<fileset dir="${lib}/mongodb-java-driver/lib" />
			<fileset dir="${lib}/mongodb-rhino-driver/lib" />
		</copy>
	</target>
	
	<target name="application" description="Fetch MongoVision application">
		<copy todir="${tmp}/applications/mongovision">
			<fileset dir="${src}" />
		</copy>
		<zip destfile="${content}/mongovision.prudence.zip" basedir="${tmp}" includes="**/*" />
	</target>

	<target name="deploy" depends="application, libraries" description="Fetch deployment">
		<copy todir="${content}">
			<fileset dir="${deploy}" />
		</copy>
	</target>
	
	<target name="package" depends="licenses, deploy" description="Create MongoVision zip">
		<zip destfile="mongovision.zip" basedir="${content}" includes="**/*" />
	</target>
	
	<target name="build" depends="package" description="Build distribution" />
	
	<target name="clean" description="Clean">
		<delete dir="${tmp}" />
		<delete dir="${dist}" />
	</target>
	
	<target name="rebuild" depends="clean, build" description="Clean and build distribution" />

</project>
